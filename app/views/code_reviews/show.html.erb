<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1>Code Review</h1>
    <div class="d-flex gap-2">
      <%= link_to 'Edit', edit_code_review_path(@code_review), class: 'btn btn-primary' %>
      <%= link_to 'Back', code_reviews_path, class: 'btn btn-secondary' %>
    </div>
  </div>

  <div class="card mb-4">
    <div class="card-header">
      <h2>Basic Information</h2>
    </div>
    <div class="card-body">
      <div class="row mb-3">
        <div class="col-md-3"><strong>Repository URL:</strong></div>
        <div class="col-md-9"><%= link_to @code_review.repository_url, @code_review.repository_url, target: '_blank' %></div>
      </div>
      <div class="row mb-3">
        <div class="col-md-3"><strong>Candidate:</strong></div>
        <div class="col-md-9"><%= @code_review.candidate_name %></div>
      </div>
      <div class="row mb-3">
        <div class="col-md-3"><strong>Reviewer:</strong></div>
        <div class="col-md-9"><%= @code_review.reviewer_name %></div>
      </div>
      <div class="row mb-3">
        <div class="col-md-3"><strong>Total Score:</strong></div>
        <div class="col-md-9"><%= @code_review.total_score %> / 115</div>
      </div>
      <div class="row mb-3">
        <div class="col-md-3"><strong>Assessment Level:</strong></div>
        <div class="col-md-9"><%= @code_review.assessment_level %></div>
      </div>
    </div>
  </div>

  <div class="card mb-4">
    <div class="card-header">
      <h2>Scores Breakdown</h2>
    </div>
    <div class="card-body">
      <!-- Code Clarity -->
      <div class="card mb-4">
        <div class="card-header">
          <h2>Code Clarity (<%= @code_review.clarity_scores["total_score"] %> / 35)</h2>
        </div>
        <div class="card-body">
          <div class="ms-4 mb-3">
            <div class="row mb-3">
              <div class="col-md-2">Method Simplicity:</div>
              <div class="col-md-2"><%= @code_review.clarity_scores.dig("method_simplicity", "score") %> / 10</div>
              <div class="col-md-2">Feedback:</div>
              <div class="col-md-6 text-secondary">
                <%= @code_review.clarity_scores.dig("method_simplicity", "feedback") %>
              </div>
            </div>

            <div class="row mb-3">
              <div class="col-md-2">Naming Conventions:</div>
              <div class="col-md-2"><%= @code_review.clarity_scores.dig("naming_conventions", "score") %> / 10</div>
              <div class="col-md-2">Feedback:</div>
              <div class="col-md-6 text-secondary">
                <%= @code_review.clarity_scores.dig("naming_conventions", "feedback") %>
              </div>
            </div>

            <div class="row mb-3">
              <div class="col-md-2">Code Organization:</div>
              <div class="col-md-2"><%= @code_review.clarity_scores.dig("code_organization", "score") %> / 10</div>
              <div class="col-md-2">Feedback:</div>
              <div class="col-md-6 text-secondary">
                <%= @code_review.clarity_scores.dig("code_organization", "feedback") %>
              </div>
            </div>

            <div class="row mb-3">
              <div class="col-md-2">Comments Quality:</div>
              <div class="col-md-2"><%= @code_review.clarity_scores.dig("comments_quality", "score") %> / 5</div>
              <div class="col-md-2">Feedback:</div>
              <div class="col-md-6 text-secondary">
                <%= @code_review.clarity_scores.dig("comments_quality", "feedback") %>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Documentation -->
      <div class="card mb-4">
        <div class="card-header">
          <h2>Documentation (<%= @code_review.practices_scores["total_score"] %> / 25)</h2>
        </div>
        <div class="card-body">
          <div class="ms-4 mb-3">
            <div class="row mb-3">
              <div class="col-md-2">Commit Quality:</div>
              <div class="col-md-2"><%= @code_review.practices_scores.dig("commit_quality", "score") %> / 10</div>
              <div class="col-md-2">Feedback:</div>
              <div class="col-md-6 text-secondary">
                <%= @code_review.practices_scores.dig("commit_quality", "feedback") %>
              </div>
            </div>

            <div class="row mb-3">
              <div class="col-md-2">Basic Testing:</div>
              <div class="col-md-2"><%= @code_review.practices_scores.dig("basic_testing", "score") %> / 10</div>
              <div class="col-md-2">Feedback:</div>
              <div class="col-md-6 text-secondary">
                <%= @code_review.practices_scores.dig("basic_testing", "feedback") %>
              </div>
            </div>

            <div class="row mb-3">
              <div class="col-md-2">Documentation:</div>
              <div class="col-md-2"><%= @code_review.practices_scores.dig("documentation", "score") %> / 5</div>
              <div class="col-md-2">Feedback:</div>
              <div class="col-md-6 text-secondary">
                <%= @code_review.practices_scores.dig("documentation", "feedback") %>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Architecture -->
      <div class="card mb-4">
        <div class="card-header">
          <h2>Architecture (<%= @code_review.architecture_scores["total_score"] %> / 25)</h2>
        </div>
        <div class="card-body">
          <div class="ms-4 mb-3">
            <div class="row mb-3">
              <div class="col-md-2">Separation of Concerns:</div>
              <div class="col-md-2"><%= @code_review.architecture_scores.dig("separation_of_concerns", "score") %> / 10</div>
              <div class="col-md-2">Feedback:</div>
              <div class="col-md-6 text-secondary">
                <%= @code_review.architecture_scores.dig("separation_of_concerns", "feedback") %>
              </div>
            </div>

            <div class="row mb-3">
              <div class="col-md-2">File Organization:</div>
              <div class="col-md-2"><%= @code_review.architecture_scores.dig("file_organization", "score") %> / 5</div>
              <div class="col-md-2">Feedback:</div>
              <div class="col-md-6 text-secondary">
                <%= @code_review.architecture_scores.dig("file_organization", "feedback") %>
              </div>
            </div>

            <div class="row mb-3">
              <div class="col-md-2">Dependency Management:</div>
              <div class="col-md-2"><%= @code_review.architecture_scores.dig("dependency_management", "score") %> / 5</div>
              <div class="col-md-2">Feedback:</div>
              <div class="col-md-6 text-secondary">
                <%= @code_review.architecture_scores.dig("dependency_management", "feedback") %>
              </div>
            </div>

            <div class="row mb-3">
              <div class="col-md-2">Framework Usage:</div>
              <div class="col-md-2"><%= @code_review.architecture_scores.dig("framework_usage", "score") %> / 5</div>
              <div class="col-md-2">Feedback:</div>
              <div class="col-md-6 text-secondary">
                <%= @code_review.architecture_scores.dig("framework_usage", "feedback") %>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Problem Solving -->
      <div class="card mb-4">
        <div class="card-header">
          <h2>Problem Solving (<%= @code_review.problem_solving_scores["total_score"] %> / 15)</h2>
        </div>
        <div class="card-body">
          <div class="ms-4 mb-3">
            <div class="row mb-3">
              <div class="col-md-2">Solution Simplicity:</div>
              <div class="col-md-2"><%= @code_review.problem_solving_scores.dig("solution_simplicity", "score") %> / 10</div>
              <div class="col-md-2">Feedback:</div>
              <div class="col-md-6 text-secondary">
                <%= @code_review.problem_solving_scores.dig("solution_simplicity", "feedback") %>
              </div>
            </div>

            <div class="row mb-3">
              <div class="col-md-2">Code Reuse:</div>
              <div class="col-md-2"><%= @code_review.problem_solving_scores.dig("code_reuse", "score") %> / 5</div>
              <div class="col-md-2">Feedback:</div>
              <div class="col-md-6 text-secondary">
                <%= @code_review.problem_solving_scores.dig("code_reuse", "feedback") %>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Bonus Points -->
      <div class="card mb-4">
        <div class="card-header">
          <h2>Bonus Points (<%= @code_review.bonus_scores["total_score"] %> / 15)</h2>
        </div>
        <div class="card-body">
          <div class="ms-4 mb-3">
            <div class="row mb-3">
              <div class="col-md-2">Advanced Testing:</div>
              <div class="col-md-2"><%= @code_review.bonus_scores.dig("advanced_testing", "score") %> / 5</div>
              <div class="col-md-2">Feedback:</div>
              <div class="col-md-6 text-secondary">
                <%= @code_review.bonus_scores.dig("advanced_testing", "feedback") %>
              </div>
            </div>

            <div class="row mb-3">
              <div class="col-md-2">Security Practices:</div>
              <div class="col-md-2"><%= @code_review.bonus_scores.dig("security_practices", "score") %> / 5</div>
              <div class="col-md-2">Feedback:</div>
              <div class="col-md-6 text-secondary">
                <%= @code_review.bonus_scores.dig("security_practices", "feedback") %>
              </div>
            </div>

            <div class="row mb-3">
              <div class="col-md-2">Performance:</div>
              <div class="col-md-2"><%= @code_review.bonus_scores.dig("performance_considerations", "score") %> / 5</div>
              <div class="col-md-2">Feedback:</div>
              <div class="col-md-6 text-secondary">
                <%= @code_review.bonus_scores.dig("performance_considerations", "feedback") %>
              </div>
            </div>
          </div>
        </div>
      </div>

      <% if @code_review.non_working_solution? %>
        <div class="alert alert-warning">
          <strong>Non-working Solution:</strong> -30 points
        </div>
      <% end %>
    </div>
  </div>

  <% if @code_review.overall_comments.present? %>
    <div class="card mb-4">
      <div class="card-header">
        <h2>Overall Comments</h2>
      </div>
      <div class="card-body">
        <%= simple_format @code_review.overall_comments %>
      </div>
    </div>
  <% end %>

  <div class="delete-section mt-5 pt-4 border-top text-end">
    <%= button_to code_review_path(@code_review), 
                  method: :delete,
                  class: 'btn btn-danger',
                  form: { 
                    data: { 
                      turbo_confirm: 'Are you sure you want to delete this review?' 
                    }
                  } do %>
      <i class="fas fa-trash-alt" style="padding-right: 12px;"></i>Delete Review
    <% end %>
  </div>
</div>

<% Rails.logger.debug "Clarity Scores: #{@code_review.clarity_scores.inspect}" %>
<% Rails.logger.debug "Architecture Scores: #{@code_review.architecture_scores.inspect}" %>
<% Rails.logger.debug "Practices Scores: #{@code_review.practices_scores.inspect}" %>
<% Rails.logger.debug "Problem Solving Scores: #{@code_review.problem_solving_scores.inspect}" %>
<% Rails.logger.debug "Bonus Scores: #{@code_review.bonus_scores.inspect}" %> 